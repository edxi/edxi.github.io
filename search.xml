<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[Ansible学习笔记--从Playbook创建Role]]></title>
    <url>%2F2017%2F10%2F04%2FAnsible-PlaybookToRole%2F</url>
    <content type="text"><![CDATA[下面以一个现成的playbook为例，将其内容分解并编排成一个role。 整个步骤的终端录屏 现有playbook12345678910111213141516171819202122232425262728293031323334353637383940414243- hosts: localhost sudo: true vars: baserepo: '' updatesrepo: '' extrasrepo: ''# Task setup local repositories tasks: - name: Remove repository (and clean up left-over metadata) yum_repository: name: packages state: absent notify: yum-clean-metadata - name: Add yumserver repository template: "src=yumserver.repo dest=/etc/yum.repos.d/yumserver.repo owner=root group=root mode=0644" - name: Add epel repository with proxy yum_repository: name: epel description: EPEL YUM repo proxy: "http://&#123;&#123; proxyserver &#125;&#125;:&#123;&#123; proxyport &#125;&#125;" baseurl: http://mirrors.aliyun.com/epel/7/$basearch failovermethod: priority gpgcheck: no when: proxyserver is defined and proxyport is defined and proxyserver != '' and proxyport != '' - name: Add epel repository without proxy yum_repository: name: epel description: EPEL YUM repo baseurl: http://mirrors.aliyun.com/epel/7/$basearch failovermethod: priority gpgcheck: no when: proxyserver is not defined proxyserver == '' tags: epel_repo# Handler clean yum metadata cache handlers: - name: yum-clean-metadata command: yum clean metadata args: warn: no 上面playbook的作用是设置yum repository。 除了hosts以外，大致分成三个部分： vars——指定了playbook须要用到的变量 tasks——具体playbook运行的module，具体执行了 先清理package repository并提醒handler执行metadata清理 通过template module设置的base/updates/extras repository 用yum_repository module设置epel handlers——定义了作为handler被调用的module 这里在tasks里有个template module，对应的template如下： 12345678910111213141516171819202122232425262728293031323334353637383940[base]name=CentOS-$releasever - Base&#123;% if baserepo is defined and baserepo != &apos;&apos; %&#125;baseurl=&#123;&#123; baserepo &#125;&#125;&#123;% else %&#125;mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=os&amp;infra=$infra&#123;% endif %&#125;gpgcheck=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7&#123;% if proxyserver is defined and proxyserver != &apos;&apos; and proxyport is defined and baserepo == &apos;&apos; %&#125;proxy=http://&#123;&#123; proxyserver &#125;&#125;:&#123;&#123;proxyport&#125;&#125;&#123;% endif %&#125;#released updates[updates]name=CentOS-$releasever - Updates&#123;% if updatesrepo is defined and updatesrepo != &apos;&apos; %&#125;baseurl=&#123;&#123; updatesrepo &#125;&#125;&#123;% else %&#125;mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=updates&amp;infra=$infra&#123;% endif %&#125;gpgcheck=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7&#123;% if proxyserver is defined and proxyserver != &apos;&apos; and proxyport is defined and updatesrepo == &apos;&apos; %&#125;proxy=http://&#123;&#123; proxyserver &#125;&#125;:&#123;&#123;proxyport&#125;&#125;&#123;% endif %&#125;#additional packages that may be useful[extras]name=CentOS-$releasever - Extras&#123;% if extrasrepo is defined and extrasrepo != &apos;&apos; %&#125;baseurl=&#123;&#123; extrasrepo &#125;&#125;&#123;% else %&#125;mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=extras&amp;infra=$infra&#123;% endif %&#125;gpgcheck=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7&#123;% if proxyserver is defined and proxyserver != &apos;&apos; and proxyport is defined and extrasrepo == &apos;&apos; %&#125;proxy=http://&#123;&#123; proxyserver &#125;&#125;:&#123;&#123;proxyport&#125;&#125;&#123;% endif %&#125; 创建role创建目录结构role的固定目录结构如下 12345678910111213141516171819[root@ansible01 examplePlaybook]# mkdir yumrepo [root@ansible01 examplePlaybook]# # this is the role main directory[root@ansible01 examplePlaybook]# cd yumrepo[root@ansible01 yumrepo]# mkdir tasks[root@ansible01 yumrepo]# mkdir handlers[root@ansible01 yumrepo]# mkdir defaults[root@ansible01 yumrepo]# mkdir vars[root@ansible01 yumrepo]# mkdir files[root@ansible01 yumrepo]# mkdir templates[root@ansible01 yumrepo]# mkdir meta[root@ansible01 yumrepo]# lltotal 0drwxr-xr-x. 2 root root 6 Oct 4 15:47 defaultsdrwxr-xr-x. 2 root root 6 Oct 4 15:47 filesdrwxr-xr-x. 2 root root 6 Oct 4 15:47 handlersdrwxr-xr-x. 2 root root 6 Oct 4 15:47 metadrwxr-xr-x. 2 root root 6 Oct 4 15:47 tasksdrwxr-xr-x. 2 root root 6 Oct 4 15:47 templatesdrwxr-xr-x. 2 root root 6 Oct 4 15:47 vars 设置默认变量创建defaults目录里的main.yml用于设置默认变量。 在这个例子里，直接把playbook里用到的几个变量复制进去。 设置tasks创建tasks目录里的main.yml用于执行roles所调用的任务。 在这个例子里，直接把playbook里用到的几个任务复制了进去。 也可以讲不同功能的任务单独写成yml文件，然后通过在main.yml里使用include来调用（并可以使用when条件判断使用哪个任务，还可以使用tags方便在执行时调用对应功能的任务） 设置handlers创建handlers目录里的main.yml用于执行tasks所调用的handler。 在这个例子里，直接把playbook里用到的handler复制了进去。 复制template文件由于原有playbook使用到template module，所以须要把roles使用的template文件yumserver.yml复制到template目录。 测试role通过上面改写，自建的role已经完成，写一个简单的playbook用来测试 123- hosts: localhost roles: - yumrepo 执行playbook查看结果 123456789101112131415161718192021[root@ansible01 examplePlaybook]# ansible-playbook test.ymlPLAY [localhost] ******************************************************************************************************TASK [Gathering Facts] ************************************************************************************************ok: [localhost]TASK [yumrepo : Remove repository (and clean up left-over metadata)] **************************************************ok: [localhost]TASK [yumrepo : Add yumserver repository] *****************************************************************************changed: [localhost]TASK [yumrepo : Add epel repository with proxy] ***********************************************************************skipping: [localhost]TASK [yumrepo : Add epel repository without proxy] ********************************************************************ok: [localhost]PLAY RECAP ************************************************************************************************************localhost : ok=4 changed=1 unreachable=0 failed=0 可以修改测试playbook，加上参数以覆盖roles的默认参数 12345- hosts: localhost vars: baserepo: "http://repo.aliyun.com/yum/" roles: - yumrepo 再次执行就会按照上述不同的参数修改repository了。 总结大致总结下，role的目的是为了可以在各种环境下重用，把 vars, tasks, handlers等等playbook的组成元素放到固定的目录结构里。 更加详细的使用方法当然还是要参考了官方文档。 纸上得来终觉浅，绝知此事要躬行。]]></content>
      <categories>
        <category>学习</category>
        <category>ansible</category>
      </categories>
      <tags>
        <tag>ansible</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[阿德和有米写故事--github使用案例]]></title>
    <url>%2F2017%2F08%2F31%2Fade_xiyoumi_write_story_github_example%2F</url>
    <content type="text"><![CDATA[故事梗概故事是这样滴 ade心血来潮新建了个github的repo(仓库)， 然后在repo里乱七八糟的写了点东西后提交(commit)进repo， 好奇的xiyoumi小朋友发现了这个repo，于是把repo在自己的github上做了个副本(fork)， xiyoumi小朋友把里面的东西做了点修改，也做了自己的提交， xiyoumi小朋友想把自己改的东西也合并到ade的repo里，于是提交了pull request， ade看了下pull request，觉得修改的不错，于是就合并进了repo， xiyoumi小朋友大受鼓舞，又修改了好多东西，并再次提交pull request， ade看到这次的pull request，也不知道这样改好不好，于是ade索性新建了个test分支(branch)，并在pull request里留言告诉xiyoumi，让他合并到这个分支， 于是xiyoumi小朋友重新提交了pull request，要求把合并到test分支里， ade愉快的合并了这个pull request，并且不久后把这个分支也合并进了主干(master分支)。 剧情详情好吧，具体来看看这个故事的每一段都做了点啥 ade心血来潮新建了个github的repo(仓库)， 然后在repo里乱七八糟的写了点东西后提交(commit)进repo，1234567891011121314151617[ade@~]$git init storyInitialized empty Git repository in /home/ade/story/.git/[ade@~]$cd story[ade@story]$git remote add origin git@github.com:edxi/story.git[ade@story]$echo "this is a story repository" &gt;&gt; README.md[ade@story]$git add -A[ade@story]$git commit -m "first commit"[master (root-commit) 5a98272] first commit 1 file changed, 1 insertion(+) create mode 100644 README.md[ade@story]$git push -u origin masterCounting objects: 3, done.Writing objects: 100% (3/3), 225 bytes | 0 bytes/s, done.Total 3 (delta 0), reused 0 (delta 0)To git@github.com:edxi/story.git * [new branch] master -&gt; masterBranch master set up to track remote branch master from origin. 好奇的xiyoumi小朋友发现了这个repo，于是把repo在自己的github上做了个副本(fork)， xiyoumi小朋友把里面的东西做了点修改，也做了自己的提交，123456789101112131415161718192021222324252627282930313233[xiyoumi@~]$git clone git@github.com:xiyoumi/story.gitCloning into 'story'...remote: Counting objects: 3, done.remote: Total 3 (delta 0), reused 3 (delta 0), pack-reused 0Receiving objects: 100% (3/3), done.[xiyoumi@~]$cd story/[xiyoumi@story]$echo "三只小猪的故事" &gt;&gt; pigstory.md[xiyoumi@story]$echo "xiyoumi参与写作！" &gt;&gt; README.md[xiyoumi@story]$git commit -m "交作文！"[master 13d8cc2] 交作文！ 2 files changed, 2 insertions(+) create mode 100644 pigstory.md[xiyoumi@story]$git pushwarning: push.default is unset; its implicit value is changing inGit 2.0 from 'matching' to 'simple'. To squelch this messageand maintain the current behavior after the default changes, use: git config --global push.default matchingTo squelch this message and adopt the new behavior now, use: git config --global push.default simpleSee 'git help config' and search for 'push.default' for further information.(the 'simple' mode was introduced in Git 1.7.11. Use the similar mode'current' instead of 'simple' if you sometimes use older versions of Git)Counting objects: 6, done.Compressing objects: 100% (3/3), done.Writing objects: 100% (4/4), 372 bytes | 0 bytes/s, done.Total 4 (delta 0), reused 0 (delta 0)To git@github.com:xiyoumi/story.git 5a98272..13d8cc2 master -&gt; master xiyoumi小朋友想把自己改的东西也合并到ade的repo里，于是提交了pull request， ade看了下pull request，觉得修改的不错，于是就合并进了repo， xiyoumi小朋友大受鼓舞，又修改了好多东西，并再次提交pull request，1234567891011121314151617181920212223242526[xiyoumi@story]$echo "三只小猪最终打败了大灰狼" &gt;&gt; pigstory.md[xiyoumi@story]$git add -A[xiyoumi@story]$git commit -m "故事有更新啦！"[master 60ab6ec] 故事有更新啦！ 1 file changed, 1 insertion(+)[xiyoumi@story]$git pushwarning: push.default is unset; its implicit value is changing inGit 2.0 from 'matching' to 'simple'. To squelch this messageand maintain the current behavior after the default changes, use: git config --global push.default matchingTo squelch this message and adopt the new behavior now, use: git config --global push.default simpleSee 'git help config' and search for 'push.default' for further information.(the 'simple' mode was introduced in Git 1.7.11. Use the similar mode'current' instead of 'simple' if you sometimes use older versions of Git)Counting objects: 5, done.Compressing objects: 100% (3/3), done.Writing objects: 100% (3/3), 354 bytes | 0 bytes/s, done.Total 3 (delta 0), reused 0 (delta 0)To git@github.com:xiyoumi/story.git 13d8cc2..60ab6ec master -&gt; master ade看到这次的pull request，也不知道这样改好不好，于是ade索性新建了个test分支(branch)，并在pull request里留言告诉xiyoumi，让他合并到这个分支里 123456[ade@story]$git push origin testCounting objects: 3, done.Writing objects: 100% (3/3), 225 bytes | 0 bytes/s, done.Total 3 (delta 0), reused 0 (delta 0)To git@github.com:edxi/story.git * [new branch] test -&gt; test 于是xiyoumi小朋友重新提交了pull request，要求把合并到test分支里， ade愉快的合并了这个pull request，并且不久后把这个分支也合并进了主干(master分支)。 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748[ade@story]$git branch master* test[ade@story]$git pull origin testFrom github.com:edxi/story * branch test -&gt; FETCH_HEADUpdating 5a98272..62fe9efFast-forward README.md | 1 + pigstory.md | 2 ++ 2 files changed, 3 insertions(+) create mode 100644 pigstory.md[ade@story]$git checkout masterSwitched to branch 'master'Your branch is behind 'origin/master' by 2 commits, and can be fast-forwarded. (use "git pull" to update your local branch)[ade@story]$git pull --allFetching originUpdating 5a98272..31e542bFast-forward README.md | 1 + pigstory.md | 1 + 2 files changed, 2 insertions(+) create mode 100644 pigstory.md[ade@story]$git merge test -m "Merge branch 'test'"Merge made by the 'recursive' strategy. pigstory.md | 1 + 1 file changed, 1 insertion(+)[ade@story]$git pushwarning: push.default is unset; its implicit value is changing inGit 2.0 from 'matching' to 'simple'. To squelch this messageand maintain the current behavior after the default changes, use: git config --global push.default matchingTo squelch this message and adopt the new behavior now, use: git config --global push.default simpleSee 'git help config' and search for 'push.default' for further information.(the 'simple' mode was introduced in Git 1.7.11. Use the similar mode'current' instead of 'simple' if you sometimes use older versions of Git)Counting objects: 1, done.Writing objects: 100% (1/1), 210 bytes | 0 bytes/s, done.Total 1 (delta 0), reused 0 (delta 0)To git@github.com:edxi/story.git 31e542b..4804dda master -&gt; master 尾声到这里，已经知道了ade和xiyoumi是怎么通过github一起写故事了，可是似乎还没有这么简单，不久之后他们又有了新的问题： xiyoumi发现fork源的repo早就变了，怎么同步呢？ 随着越来越多的人加入故事投稿，分支和提交觉得乱糟糟的，怎么才能简洁点呢？能不能删除git log呢？ 问题的答案至今还不知晓~ 一个人走得快，一群人走得远 ——《有赞》广告词]]></content>
      <categories>
        <category>学习</category>
        <category>github</category>
      </categories>
      <tags>
        <tag>github</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hello World!]]></title>
    <url>%2F2017%2F08%2F23%2Fhello-world%2F</url>
    <content type="text"><![CDATA[哈喽 世界！ o(￣▽￣)ブ这是DXC守护者第一篇! 简介建站故事​ 很久之后，又开始写博客了，这次用github page，觉得舒爽轻松很多。 ​ 20年前（暴露年龄），当时国内有个凯利网站空间，可以自己做网页上传，于是用FrontPage写了个html，隔天就在教室黑板上把网站链接写在黑板上得瑟。这算是自己最早的博客了。 ​ 之后就和大多数人一样，更新最多的是msn空间，msn空间关闭后迁移到wordpress，但因为被墙，于是索性自己买了域名和空间，直到2012年，付费两年后，看到自己其实多数更新都在微博上，于是也就放弃了。 ​ 现如今，就连微博都已经做过了一轮复兴之路，朋友圈和公众号是主流，但是作为老挨踢的情怀，自己偏偏又开始写起博客了，希望这个博客可以给工作生活带来帮助。 网站作用 首先，这是我的个人博客，我说是啥用就是啥用， (￣y▽￣)╭ Ohohoho….. 然后，我想肯定会记录些生活和学习上内容吧。 再就是，希望对日常工作有所帮助，也利用github这个厉害的平台，和DXC的小鬼们分享有用的资源。 还有就是，网站因为采用Hexo+github page建站，用markdown写博客，所以本站接受大家投稿。 DXC是什么​ 其实就是我现在工作的公司名字，但是就目前为止没人知道是什么缩写~(￣▽￣)”于是就有各种奇葩翻译： 稻香村——想要成为老字号的志向~ 大香肠——某个饥渴的同事翻译的。 地下城——这个我喜欢，有个古老的游戏叫做地下城守护者，也就命名了这个网站DXC守护者。 投稿指南​ 建站前只是想把github的gh-pages改善下，然后弄着弄着就索性开始建站了，后来最终选用github page+hexo作建站工具，站点内容可以使用markdown书写，可以用纯文本编辑器书写或markdown编辑器，然后非常欢迎大家上传到这个blog-contribute repository，我会定期更新到DXC守护者网站上的。 投稿格式​ 投稿接受markdown格式，可以参考资源列表里介绍的markdown编辑器来编辑（可以做work/pdf等格式的转换，但是会有部分格式损失，所以最好还是直接用markdown编辑器来书写）。具体书写方式也可以参考资源列表里列出的资源。 ​ （可选）此外由于采用hexo建站，所以还能接受下面这类格式作为页面头信息，类似于下面格式写在md文件最前面写好就可以了（参数都是可选的）： 1234567891011---title: 文章标题date: 2013/7/13 20:46:25categories:- 学习- gittags:- git- github- git page--- 这里列举了些参数： 参数 描述 默认值 title 标题 date 建立日期 文件建立日期 updated 更新日期 文件更新日期 comments 开启文章的评论功能 true tags 标签 categories 分类 description 文章描述 投稿方式​ 目前推荐下面集中方式上传.md文件： 最简单的方式是直接通过github的issues——可以直接在DXC守护者和blog-contribute这两个repo里写issue，然后把.md的内容黏贴上来，并注明这是篇需要投稿的文章，我看过后会把相应内容post到网站的。 如果想要以文件形式维护自己的文章列表，可以先fork blog-contribute这个repo，或者直接克隆repo后创建新文件，然后通过pull request的方式把md文件合并进来，后面的资源列表里有github使用的相关链接。收到新的pull request我会看过文章内容，然后合并进来，并post到网站。 当然也接受邮件寄送给我.md文件。&#101;&#100;&#120;&#105;&#x40;&#x6d;&#x73;&#110;&#46;&#99;&#x6f;&#x6d; 资源列表markdown编辑器推荐几款markdown编辑器： typora——多平台可用的编辑器，支持所见即所得的编辑，这篇就是用它写的。 Meditor.md——开源在线 Markdown 编辑器，直接在线可以编辑，所以手头没有电脑的时候，用这个写作就可以了，而且作为一个github项目，可以下载到本地，在本地使用。 iA Writer——手机上也很好用的编辑器，安卓和IOS都支持，还可以横屏编辑，搞个平板，So IBility! 另外，其实有道云笔记也很好用，也很方便在各个平台上面分享。 markdown书写 可以参考github上的markdown链接。 另外还有个的markdown cheatsheet，作为参考列表也很方便。 此外各个编辑器平台也会针对自己的帮助文档，通常会更加详细，且带有示例。 GitHub使用 个人推荐参考大V廖雪峰的官方网站。里面有浅显移动的git教程，其中包括了结合GitHub的使用方法，对入门很有帮助。 官方帮助文档当然是最全面的。]]></content>
      <categories>
        <category>学习</category>
        <category>建站</category>
      </categories>
      <tags>
        <tag>github</tag>
        <tag>markdown</tag>
        <tag>hexo</tag>
      </tags>
  </entry>
</search>
